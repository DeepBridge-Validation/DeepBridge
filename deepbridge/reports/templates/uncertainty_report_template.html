<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepBridge - Uncertainty Validation</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        :root {
            --primary-color: #3a6ea5;
            --secondary-color: #004e8f;
            --accent-color: #ff6b6b;
            --light-bg: #f8f9fa;
            --dark-bg: #343a40;
            --text-color: #343a40;
            --light-text: #f8f9fa;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --tab-active-bg: #ffffff;
            --tab-inactive-bg: #e9ecef;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-bg);
            padding-bottom: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        header {
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3, h4, h5, h6 {
            margin-bottom: 1rem;
            font-weight: 600;
            line-height: 1.2;
        }

        h1 {
            font-size: 2.5rem;
        }

        h2 {
            font-size: 2rem;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }

        h3 {
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-top: 1.5rem;
        }

        p {
            margin-bottom: 1rem;
        }

        .subtitle {
            font-size: 1.25rem;
            opacity: 0.8;
        }

        /* Card styling for summary metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            grid-gap: 1.5rem;
            margin: 2rem 0;
        }

        .metric-card {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .metric-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .metric-description {
            font-size: 0.9rem;
            color: #666;
        }

        /* Chart container styling */
        .chart-container {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }

        .chart {
            width: 100%;
            height: 400px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        /* Make Plotly responsive within container */
        .js-plotly-plot, .plot-container {
            width: 100% !important;
            height: 100% !important;
        }

        .main-svg {
            width: 100% !important;
            height: 100% !important;
        }

        /* Feature impact */
        .feature-impact-container {
            margin: 2rem 0;
        }

        .feature-bar {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .feature-name {
            width: 150px;
            text-align: right;
            padding-right: 1rem;
            font-weight: 500;
        }

        .feature-bar-container {
            flex-grow: 1;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .feature-bar-value {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 1s ease-in-out;
        }

        .feature-impact-value {
            width: 50px;
            text-align: right;
            padding-left: 0.5rem;
        }

        /* Summary section */
        .summary-section {
            background-color: var(--light-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
        }

        /* Recommendation section */
        .recommendation-section {
            margin: 2rem 0;
        }

        .recommendation-card {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary-color);
        }

        .recommendation-title {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .recommendation-icon {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }

        .recommendation-content {
            color: #555;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin: 2rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--primary-color);
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tr:hover {
            background-color: #e9f3ff;
        }

        /* Footer */
        footer {
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 0 0.5rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            h3 {
                font-size: 1.25rem;
            }
        }

        /* React components container */
        #react-mount {
            margin-top: 2rem;
        }

        .chart-placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            background-color: #f8f9fa;
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>DeepBridge - Uncertainty Quantification Report</h1>
            <p class="subtitle">Comprehensive analysis of model uncertainty estimation</p>
        </div>
    </header>

    <div class="container">
        <div class="summary-section">
            <h2>Executive Summary</h2>
            <p><strong>Date of Analysis:</strong> {{ report_date }}</p>
            <p><strong>Model:</strong> {{ model_name }}</p>
            <p><strong>Key Finding:</strong> The model's uncertainty estimates are {{ 'well calibrated' if test_results.uncertainty_quality_score > 0.7 else 'moderately calibrated' if test_results.uncertainty_quality_score > 0.5 else 'poorly calibrated' }}.</p>
            <p>{{ summary_text }}</p>
        </div>
        
        <h2>Uncertainty Quality Metrics</h2>
        <p>These metrics evaluate how well the model quantifies uncertainty in its predictions.</p>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-title">Uncertainty Quality Score</div>
                <div class="metric-value" style="color: {{ '#28a745' if test_results.uncertainty_quality_score > 0.7 else '#ffc107' if test_results.uncertainty_quality_score > 0.5 else '#dc3545' }};">
                    {{ "%.3f"|format(test_results.uncertainty_quality_score) }}
                </div>
                <div class="metric-description">
                    <p>Overall quality of uncertainty estimates (higher is better)</p>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-title">Avg. Coverage Error</div>
                <div class="metric-value" style="color: {{ '#28a745' if test_results.avg_coverage_error < 0.05 else '#ffc107' if test_results.avg_coverage_error < 0.1 else '#dc3545' }};">
                    {{ "%.3f"|format(test_results.avg_coverage_error) }}
                </div>
                <div class="metric-description">
                    <p>Error between expected and actual prediction interval coverage</p>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-title">Avg. Interval Width</div>
                <div class="metric-value" style="color: #17a2b8;">
                    {{ "%.3f"|format(test_results.avg_normalized_width) }}
                </div>
                <div class="metric-description">
                    <p>Average width of prediction intervals (normalized)</p>
                </div>
            </div>
        </div>

        <h2>Uncertainty Analysis by Confidence Level</h2>
        <p>Analysis of model's uncertainty estimation across different confidence levels (alpha values).</p>

        <div class="chart-container">
            <h3 class="chart-title">Confidence Level Comparison</h3>
            <div id="alpha_comparison_chart" class="chart"></div>
            <p>Comparison of coverage and interval width across different confidence levels.</p>
        </div>

        <h3>Detailed Results by Confidence Level</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Alpha</th>
                        <th>Expected Coverage</th>
                        <th>Actual Coverage</th>
                        <th>Mean Width</th>
                        <th>Median Width</th>
                        <th>Coverage Error</th>
                    </tr>
                </thead>
                <tbody>
                    {% for alpha, alpha_data in test_results.crqr.by_alpha|dictsort %}
                    {% set overall = alpha_data.overall_result %}
                    <tr>
                        <td>{{ alpha }}</td>
                        <td>{{ "%.1f"|format((1-alpha|float)*100) }}%</td>
                        <td>{{ "%.1f"|format(overall.coverage*100) }}%</td>
                        <td>{{ "%.3f"|format(overall.mean_width) }}</td>
                        <td>{{ "%.3f"|format(overall.median_width) }}</td>
                        <td>{{ "%.3f"|format(overall.coverage - overall.expected_coverage) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <h2>Feature Impact on Uncertainty</h2>
        <p>Analysis of how individual features affect the model's uncertainty estimates.</p>

        <div class="chart-container">
            <h3 class="chart-title">Feature Importance for Uncertainty</h3>
            <div id="feature_importance_chart" class="chart"></div>
            <p>Features with higher importance have greater impact on the model's uncertainty estimates.</p>
        </div>

        <div class="feature-impact-container">
            <h3>Top Features Impacting Uncertainty</h3>
            
            {% set sorted_features = test_results.feature_importance|dictsort(by='value', reverse=true) %}
            {% set top_features = sorted_features[:5] if sorted_features|length > 5 else sorted_features %}
            
            {% for feature, value in top_features %}
            {% set percentage = (value / top_features[0][1] * 100)|float %}
            <div class="feature-bar">
                <div class="feature-name">{{ feature }}</div>
                <div class="feature-bar-container">
                    <div class="feature-bar-value" style="width: {{ percentage }}%;"></div>
                </div>
                <div class="feature-impact-value">{{ "%.3f"|format(value) }}</div>
            </div>
            {% endfor %}
            
            <p class="metric-description">Features with higher values have greater impact on model uncertainty.</p>
        </div>

        <h2>Prediction Interval Analysis</h2>
        <p>Analysis of the model's prediction intervals and their accuracy.</p>

        <div class="chart-container">
            <h3 class="chart-title">Prediction Intervals Overview</h3>
            <div id="prediction_interval_chart" class="chart"></div>
            <p>Visual representation of prediction intervals for sample data points.</p>
        </div>

        <div class="chart-container">
            <h3 class="chart-title">Uncertainty Calibration</h3>
            <div id="uncertainty_calibration_chart" class="chart"></div>
            <p>Reliability diagram showing how well calibrated the model's uncertainty estimates are. Ideally, the predicted probability should match the observed frequency.</p>
        </div>

        <h2>Recommendations</h2>
        <div class="recommendation-section">
            <div class="recommendation-card">
                <div class="recommendation-title">
                    <span class="recommendation-icon">🔍</span>
                    Use Lower Alpha Value for Higher Coverage
                </div>
                <div class="recommendation-content">
                    Alpha = 0.1 (90% confidence intervals) shows better calibration with a coverage error of {{ "%.3f"|format(test_results.crqr.by_alpha['0.1'].overall_result.coverage - test_results.crqr.by_alpha['0.1'].overall_result.expected_coverage) }}. We recommend using this confidence level for critical applications where high coverage is important.
                </div>
            </div>
            
            <div class="recommendation-card">
                <div class="recommendation-title">
                    <span class="recommendation-icon">🔍</span>
                    Focus on High-Impact Features
                </div>
                <div class="recommendation-content">
                    {% set top_feature = test_results.feature_importance|dictsort(by='value', reverse=true)[0] %}
                    Feature {{ top_feature[0] }} has the highest impact on uncertainty ({{ "%.3f"|format(top_feature[1]) }}). Ensuring high data quality for this feature is crucial for reliable uncertainty estimates.
                </div>
            </div>
            
            <div class="recommendation-card">
                <div class="recommendation-title">
                    <span class="recommendation-icon">🔍</span>
                    Monitor Calibration in Production
                </div>
                <div class="recommendation-content">
                    The model's uncertainty estimates show good calibration in test data, but we recommend monitoring calibration in production to detect potential drift in uncertainty quality.
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Generated by DeepBridge - Uncertainty Validation | {{ report_date }}</p>
        <p>© 2025 DeepBridge</p>
    </footer>

    <!-- React components for visualization -->
    <div id="react-uncertainty-components">
        <div id="react-coverage-comparison"></div>
        <div id="react-interval-width"></div>
        <div id="react-feature-importance"></div>
        <div id="react-alpha-comparison"></div>
        <div id="react-prediction-interval"></div>
        <div id="react-uncertainty-calibration"></div>
        <div id="react-uncertainty-dashboard"></div>
    </div>

    <!-- Load React Components for Uncertainty Visualization -->
    {% if include_react_components %}
    <script type="text/babel">
        // Load and render the components
        const CoverageComparisonChart = props => {
            const [chartData, setChartData] = React.useState(null);
            
            React.useEffect(() => {
                // Fetch the component source
                fetch('{{ uncertainty_visualization_path }}/coverage-comparison-chart.tsx')
                .then(response => response.text())
                .then(sourceCode => {
                    try {
                        // Extract the component data
                        const dataMatch = sourceCode.match(/const\s+data\s*=\s*{[^}]*}/gs);
                        if (dataMatch) {
                            // Convert to proper JSON and parse
                            const processedData = dataMatch[0]
                                .replace(/const\s+data\s*=\s*/, '')
                                .replace(/'/g, '"');
                            
                            setChartData(JSON.parse(processedData));
                        }
                    } catch (error) {
                        console.error("Error parsing component data:", error);
                    }
                })
                .catch(error => {
                    console.error("Error fetching component:", error);
                });
            }, []);
            
            if (!chartData) {
                return <div className="chart-placeholder">Loading coverage comparison chart...</div>;
            }
            
            return (
                <div className="chart-container">
                    <h3 className="chart-title">Cobertura de Intervalos de Confiança</h3>
                    <div className="chart">
                        <div id="coverage_comparison_chart"></div>
                    </div>
                    <p>Este gráfico mostra a cobertura real versus a cobertura esperada dos intervalos de confiança.</p>
                </div>
            );
        };
        
        const IntervalWidthChart = props => {
            return (
                <div className="chart-container">
                    <h3 className="chart-title">Largura dos Intervalos de Confiança</h3>
                    <div className="chart">
                        <div id="interval_width_chart"></div>
                    </div>
                    <p>Este gráfico mostra a largura média e mediana dos intervalos de confiança.</p>
                </div>
            );
        };
        
        const FeatureImportanceUncertaintyChart = props => {
            return (
                <div className="chart-container">
                    <h3 className="chart-title">Importância de Features para Incerteza</h3>
                    <div className="chart">
                        <div id="feature_importance_uncertainty_chart"></div>
                    </div>
                    <p>Este gráfico mostra a importância das features para a incerteza do modelo.</p>
                </div>
            );
        };
        
        const AlphaComparisonChart = props => {
            return (
                <div className="chart-container">
                    <h3 className="chart-title">Comparação entre Níveis de Confiança</h3>
                    <div className="chart">
                        <div id="alpha_comparison_chart"></div>
                    </div>
                    <p>Este gráfico compara os diferentes níveis de confiança (alpha).</p>
                </div>
            );
        };
        
        const PredictionIntervalChart = props => {
            return (
                <div className="chart-container">
                    <h3 className="chart-title">Intervalos de Previsão por Amostra</h3>
                    <div className="chart">
                        <div id="prediction_interval_chart"></div>
                    </div>
                    <p>Este gráfico mostra intervalos de previsão para algumas amostras selecionadas.</p>
                </div>
            );
        };
        
        const UncertaintyCalibrationChart = props => {
            return (
                <div className="chart-container">
                    <h3 className="chart-title">Calibração de Incerteza</h3>
                    <div className="chart">
                        <div id="uncertainty_calibration_chart"></div>
                    </div>
                    <p>Este gráfico mostra a calibração de incerteza do modelo.</p>
                </div>
            );
        };
        
        // Main dashboard component
        const UncertaintyDashboard = props => {
            return (
                <div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <CoverageComparisonChart />
                        <IntervalWidthChart />
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <FeatureImportanceUncertaintyChart />
                        <AlphaComparisonChart />
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <PredictionIntervalChart />
                        <UncertaintyCalibrationChart />
                    </div>
                </div>
            );
        };
        
        // Render the dashboard
        ReactDOM.render(
            <UncertaintyDashboard />,
            document.getElementById('react-uncertainty-dashboard')
        );
    </script>
    {% endif %}

    <script type="text/babel">
        // React components will be mounted after data is loaded
        document.addEventListener("DOMContentLoaded", function(){
            // Initialize Plotly charts with data from template
            try {
                // Example data structure for charts
                const exampleData = {
                    alpha_comparison: {
                        data: [
                            {
                                x: ['0.1', '0.2'],
                                y: [0.95, 0.90],
                                name: 'Actual Coverage',
                                type: 'bar',
                                marker: {color: '#3182CE'}
                            },
                            {
                                x: ['0.1', '0.2'],
                                y: [0.9, 0.8],
                                name: 'Expected Coverage',
                                type: 'bar',
                                marker: {color: '#E53E3E'}
                            },
                            {
                                x: ['0.1', '0.2'],
                                y: [0.45, 0.27],
                                name: 'Mean Width',
                                type: 'bar',
                                marker: {color: '#805AD5'},
                                yaxis: 'y2'
                            }
                        ],
                        layout: {
                            title: 'Confidence Level Comparison',
                            barmode: 'group',
                            yaxis: {
                                title: 'Coverage',
                                side: 'left',
                                range: [0, 1]
                            },
                            yaxis2: {
                                title: 'Interval Width',
                                side: 'right',
                                overlaying: 'y',
                                range: [0, 0.5]
                            },
                            legend: {
                                orientation: 'h',
                                y: -0.2
                            }
                        }
                    },
                    feature_importance: {
                        data: [
                            {
                                x: [0.22, 0.09, 0.01],
                                y: ['feature_2', 'feature_0', 'feature_1'],
                                type: 'bar',
                                orientation: 'h',
                                marker: {
                                    color: '#805AD5'
                                }
                            }
                        ],
                        layout: {
                            title: 'Feature Importance for Uncertainty',
                            xaxis: {
                                title: 'Importance Score'
                            },
                            yaxis: {
                                title: 'Feature',
                                automargin: true
                            }
                        }
                    },
                    prediction_interval: {
                        data: [
                            {
                                y: [0.42, 0.95, 1.05, 1.01, 0.10, 0.82],
                                x: [1, 2, 3, 4, 5, 6],
                                type: 'scatter',
                                mode: 'markers',
                                name: 'Actual Value',
                                marker: {
                                    color: '#3182CE',
                                    size: 10
                                }
                            },
                            {
                                y: [0.01, 0.84, 0.91, 0.88, -0.13, 0.40],
                                x: [1, 2, 3, 4, 5, 6],
                                type: 'scatter',
                                mode: 'lines',
                                name: 'Lower Bound',
                                line: {
                                    color: '#E53E3E',
                                    width: 1,
                                    dash: 'dot'
                                }
                            },
                            {
                                y: [0.84, 1.08, 1.14, 1.15, 0.33, 1.15],
                                x: [1, 2, 3, 4, 5, 6],
                                type: 'scatter',
                                mode: 'lines',
                                name: 'Upper Bound',
                                line: {
                                    color: '#E53E3E',
                                    width: 1,
                                    dash: 'dot'
                                },
                                fill: 'tonexty',
                                fillcolor: 'rgba(231, 76, 60, 0.1)'
                            }
                        ],
                        layout: {
                            title: 'Prediction Intervals',
                            xaxis: {
                                title: 'Sample Index'
                            },
                            yaxis: {
                                title: 'Value'
                            }
                        }
                    },
                    uncertainty_calibration: {
                        data: [
                            {
                                x: [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0],
                                y: [0, 0.12, 0.22, 0.32, 0.43, 0.54, 0.65, 0.76, 0.85, 0.96, 1.0],
                                type: 'scatter',
                                mode: 'lines+markers',
                                name: 'Actual',
                                marker: {
                                    color: '#3182CE',
                                    size: 8
                                },
                                line: {
                                    color: '#3182CE',
                                    width: 2
                                }
                            },
                            {
                                x: [0, 1],
                                y: [0, 1],
                                type: 'scatter',
                                mode: 'lines',
                                name: 'Perfect Calibration',
                                line: {
                                    color: '#A0AEC0',
                                    width: 2,
                                    dash: 'dash'
                                }
                            }
                        ],
                        layout: {
                            title: 'Uncertainty Calibration',
                            xaxis: {
                                title: 'Predicted Probability',
                                range: [0, 1]
                            },
                            yaxis: {
                                title: 'Observed Frequency',
                                range: [0, 1]
                            },
                            showlegend: true
                        }
                    }
                };

                // Try to load chart data from template variables or use example data
                const alphaComparisonData = {{ alpha_comparison_chart|default('null') }};
                const featureImportanceData = {{ feature_importance_chart|default('null') }};
                const predictionIntervalData = {{ prediction_interval_chart|default('null') }};
                const uncertaintyCalibrationData = {{ uncertainty_calibration_chart|default('null') }};

                // Render charts with available data
                Plotly.newPlot('alpha_comparison_chart', 
                    (alphaComparisonData && alphaComparisonData.data) ? alphaComparisonData.data : exampleData.alpha_comparison.data, 
                    (alphaComparisonData && alphaComparisonData.layout) ? alphaComparisonData.layout : exampleData.alpha_comparison.layout,
                    {responsive: true}
                );

                Plotly.newPlot('feature_importance_chart', 
                    (featureImportanceData && featureImportanceData.data) ? featureImportanceData.data : exampleData.feature_importance.data, 
                    (featureImportanceData && featureImportanceData.layout) ? featureImportanceData.layout : exampleData.feature_importance.layout,
                    {responsive: true}
                );

                Plotly.newPlot('prediction_interval_chart', 
                    (predictionIntervalData && predictionIntervalData.data) ? predictionIntervalData.data : exampleData.prediction_interval.data, 
                    (predictionIntervalData && predictionIntervalData.layout) ? predictionIntervalData.layout : exampleData.prediction_interval.layout,
                    {responsive: true}
                );

                Plotly.newPlot('uncertainty_calibration_chart', 
                    (uncertaintyCalibrationData && uncertaintyCalibrationData.data) ? uncertaintyCalibrationData.data : exampleData.uncertainty_calibration.data, 
                    (uncertaintyCalibrationData && uncertaintyCalibrationData.layout) ? uncertaintyCalibrationData.layout : exampleData.uncertainty_calibration.layout,
                    {responsive: true}
                );

                // Additional chart renderings for React components
                Plotly.newPlot('coverage_comparison_chart', exampleData.uncertainty_calibration.data, exampleData.uncertainty_calibration.layout, {responsive: true});
                Plotly.newPlot('interval_width_chart', exampleData.prediction_interval.data, exampleData.prediction_interval.layout, {responsive: true});
                Plotly.newPlot('feature_importance_uncertainty_chart', exampleData.feature_importance.data, exampleData.feature_importance.layout, {responsive: true});

                console.log("All charts rendered successfully");
            } catch (error) {
                console.error("Error rendering charts:", error);
            }
        });

        // Handle window resize for responsive charts
        window.addEventListener('resize', function() {
            // Resize all Plotly charts
            const charts = ['alpha_comparison_chart', 'feature_importance_chart', 
                           'prediction_interval_chart', 'uncertainty_calibration_chart'];
            
            charts.forEach(chartId => {
                const chartElement = document.getElementById(chartId);
                if (chartElement) {
                    try {
                        Plotly.relayout(chartId, {
                            'width': chartElement.offsetWidth,
                            'height': chartElement.offsetHeight
                        });
                    } catch (e) {
                        console.warn(`Error resizing chart ${chartId}:`, e);
                    }
                }
            });
        });
    </script>
</body>
</html>