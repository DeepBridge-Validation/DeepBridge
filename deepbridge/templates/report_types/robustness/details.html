{% from "components/tables/data_table.html" import data_table %}
{% include "components/ui/subtabs.html" %}

<div class="details-section">
    <div class="card">
        <h2>Detailed Robustness Results</h2>
        <p>This section provides detailed breakdown of robustness test results across different levels and metrics.</p>
        
        <div class="subtabs-container">
            <div class="subtabs" data-parent="details">
                <div class="subtab active" data-subtab="raw_details" data-parent="details">
                    Raw Perturbation
                </div>
                <div class="subtab" data-subtab="quantile_details" data-parent="details">
                    Quantile Perturbation
                </div>
                <div class="subtab" data-subtab="metrics_details" data-parent="details">
                    Model Metrics
                </div>
            </div>
        </div>
        
        <!-- Raw Perturbation Details Content -->
        <div id="raw_details" class="subtab-content active" data-parent="details">
            <div class="raw-details-container">
                <h3>Raw Perturbation Details</h3>
                <p>Performance metrics for each perturbation level with raw values.</p>
                
                <div id="raw-details-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Quantile Perturbation Details Content -->
        <div id="quantile_details" class="subtab-content" data-parent="details">
            <div class="quantile-details-container">
                <h3>Quantile Perturbation Details</h3>
                <p>Performance metrics for each perturbation level with quantile-based values.</p>
                
                <div id="quantile-details-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Model Metrics Content -->
        <div id="metrics_details" class="subtab-content" data-parent="details">
            <div class="metrics-details">
                <h3>Model Metrics</h3>
                <p>Key performance metrics for the model across different test conditions.</p>
                
                <div id="metrics-table-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Container for all detailed results, dynamically populated -->
        <div id="detailed-results-container" style="display:none;">
            <!-- This container is used by the JavaScript but we'll reorganize its content -->
        </div>
    </div>
</div>

<style>
    .details-section {
        margin-bottom: 30px;
    }
    
    .metrics-details,
    .raw-details-container,
    .quantile-details-container {
        margin-bottom: 30px;
    }
    
    .level-details {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }
    
    .level-details:last-child {
        border-bottom: none;
    }
    
    .raw-details-container h3,
    .quantile-details-container h3,
    .metrics-details h3 {
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 18px;
        color: #2c3e50;
    }
    
    .level-details h4 {
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 16px;
        color: #444;
    }
    
    .level-details h5 {
        margin-top: 15px;
        margin-bottom: 10px;
        font-size: 14px;
        color: #666;
    }
</style>

<script>
document.addEventListener('renderCharts', function() {
    // Move content from detailed-results-container to appropriate subcontainers
    setTimeout(function() {
        const detailedContainer = document.getElementById('detailed-results-container');
        const rawContainer = document.getElementById('raw-details-container');
        const quantileContainer = document.getElementById('quantile-details-container');
        
        if (detailedContainer && rawContainer) {
            // Find raw perturbation section
            const rawSections = detailedContainer.querySelectorAll('.detail-section');
            rawSections.forEach(section => {
                const title = section.querySelector('h3');
                if (title && title.textContent.includes('Raw Perturbation')) {
                    rawContainer.appendChild(section);
                } else if (title && title.textContent.includes('Quantile Perturbation') && quantileContainer) {
                    quantileContainer.appendChild(section);
                }
            });
        }
    }, 500);
});
</script>