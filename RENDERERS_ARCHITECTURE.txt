╔════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                     DeepBridge Report Renderers - Architecture Diagram                                 ║
╚════════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   BaseRenderer (678 LOC)                                             │
│                                                                                                       │
│  ┌───────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ Template Method Pattern (Template & Asset Loading)                                           │  │
│  │                                                                                               │  │
│  │  • _load_template(test_type, report_type)        → Load Jinja2 template                     │  │
│  │  • _get_assets(test_type)                        → Get CSS/JS/Logo/Favicon                 │  │
│  │  • _get_css_content(test_type)                   → Compile CSS via CSSManager               │  │
│  │  • _get_js_content(test_type)                    → Get JavaScript (overridable)             │  │
│  │  • _render_template(template, context)           → Render Jinja2                            │  │
│  │  • _create_base_context(report_data, ...)        → Create template context (Modern)         │  │
│  └───────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                       │
│  ┌───────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ Output Management                                                                            │  │
│  │                                                                                               │  │
│  │  • _write_html(html, file_path)          → Write HTML to file                              │  │
│  │  • _write_report(html, file_path)        → Legacy alias (DEPRECATED)                       │  │
│  │  • _ensure_output_dir(file_path)         → Create output directory                         │  │
│  │  • _fix_html_entities(html)              → Fix HTML entity escaping                        │  │
│  └───────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                       │
│  ┌───────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ Data Serialization (LEGACY - To Be Removed)                                                 │  │
│  │                                                                                               │  │
│  │  • _json_serializer(obj)                         → Keep (used by JsonFormatter)             │  │
│  │  • _safe_json_dumps(data)                        → Keep (wrapper)                           │  │
│  │  • _create_serializable_data(data)               → REMOVE (170 LOC)                        │  │
│  │  • _process_alternative_models(alt_models)       → REMOVE (170 LOC)                        │  │
│  │  • _create_context(...)                          → REMOVE - Legacy (74 LOC)                │  │
│  └───────────────────────────────────────────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘

                                         ↓ Inheritance

┌──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┬─────────────────────┐
│                      │                      │                      │                      │                     │
│  UncertaintyRenderer │  RobustnessRenderer  │  ResilienceRenderer  │   FairnessRenderer   │ HyperparameterRenderer
│  Simple (113 LOC)    │  Simple (121 LOC)    │  Simple (112 LOC)    │   Simple (145 LOC)   │ (111 LOC)
│  ✓ GOOD              │  ✓ GOOD              │  ✓ GOOD              │  ✓ GOOD              │ ✗ NEEDS FIX
├──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼─────────────────────┤
│ Inherits: YES        │ Inherits: YES        │ Inherits: YES        │ Inherits: YES        │ Inherits: NO (!)
├──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼─────────────────────┤
│ render()             │ render()             │ render()             │ render()             │ render() - Custom
│ • Transform data     │ • Transform data     │ • Transform data     │ • Transform data     │ • Composition pattern
│ • Load template      │ • Load template      │ • Load template      │ • Load template      │ • Manual asset load
│ • Get assets         │ • Get assets         │ • Get assets         │ • Get assets         │ • Manual template load
│ • Create context     │ • Create context     │ • Create context     │ • Create context     │ • Wrong method calls
│ • Add fields         │ • Add fields         │ • Add fields         │ • Add fields         │ • Wrong naming
│ • Render & write     │ • Render & write     │ • Render & write     │ • Render & write     │
├──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼─────────────────────┤
│ Transformer:         │ Transformer:         │ Transformer:         │ Transformer:         │ Transformer:
│ Uncertainty          │ Robustness           │ Resilience           │ Fairness             │ Hyperparameter
│ DataTransformer      │ DataTransformer      │ DataTransformer      │ DataTransformer      │ DataTransformer
├──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼─────────────────────┤
│ Custom Methods: 0    │ Custom Methods: 0    │ Custom Methods: 0    │ Custom Methods: 1    │ Custom Methods: 0
│                      │                      │                      │ _format_number()     │
├──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼─────────────────────┤
│ Context Fields:      │ Context Fields:      │ Context Fields:      │ Context Fields:      │ Context Fields:
│ • uncertainty_score  │ • robustness_score   │ • resilience_score   │ • fairness_score     │ • importance_scores
│ • total_alphas       │ • base_score         │ • total_scenarios    │ • protected_attrs    │ • tuning_order
│ • avg_coverage       │ • avg_impact         │ • valid_scenarios    │ • warnings           │ • optimization_
│ • avg_width          │ • metric             │ • total_features     │ • critical_issues    │   results
│                      │                      │                      │ • threshold_analysis │
├──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼─────────────────────┤
│ Duplication Elim.:   │ Duplication Elim.:   │ Duplication Elim.:   │ Duplication Elim.:   │ Duplication:
│ 180 LOC              │ 130 LOC              │ 115 LOC              │ 105 LOC              │ 50+ LOC (ISSUE!)
│ Phase 2 ✓            │ Phase 2 ✓            │ Phase 2 ✓            │ Phase 2 ✓            │ Needs Phase 3
└──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┴─────────────────────┘


════════════════════════════════════════════════════════════════════════════════════════════════════════

                                  Inheritance Hierarchy (CURRENT)

                          ┌─────────────────────────────────┐
                          │      BaseRenderer               │
                          │  (template method pattern)       │
                          └─────────────────────────────────┘
                                      ▲
                    ┌───────────┬─────┴─────┬───────────┬──────────────┐
                    │           │           │           │              │
              ┌─────┴────┐  ┌───┴────┐  ┌──┴───┐  ┌───┴────┐    ┌─────┴────┐
              │Uncertainty│  │Robustness│ │Resilience│ │Fairness│    │Hyperparameter│
              │Renderer   │  │Renderer   │ │Renderer  │ │Renderer│    │Renderer      │
              │Simple(✓)  │  │Simple(✓)  │ │Simple(✓) │ │Simple(✓)│  │(✗ ISSUE)     │
              └──────────┘  └──────────┘ └──────────┘ └────────┘    └──────────────┘
                    ✓ CORRECT              COMPOSITION    
                    INHERITANCE            PATTERN        
                    PATTERN               (BROKEN!)       

════════════════════════════════════════════════════════════════════════════════════════════════════════

                                  Phase 3 Refactoring Plan

    ╔════════════════════════════════════════════════════════════════════════════════╗
    ║ Priority 1: Fix HyperparameterRenderer (HIGH ROI) - 50 LOC Savings            ║
    ║ ✓ Make it inherit from BaseRenderer instead of composition                     ║
    ║ ✓ Remove manual template/asset loading (23 LOC)                               ║
    ║ ✓ Use _create_base_context() instead of _create_context() (4 LOC)             ║
    ║ ✓ Use _write_html() instead of _write_report() (0 LOC - method rename)        ║
    ╚════════════════════════════════════════════════════════════════════════════════╝

    ╔════════════════════════════════════════════════════════════════════════════════╗
    ║ Priority 2: Remove Legacy Code (MAINTENANCE) - 244 LOC Savings                 ║
    ║ ✓ Remove _create_context() method (74 LOC)                                     ║
    ║ ✓ Remove _create_serializable_data() (75 LOC)                                  ║
    ║ ✓ Remove _process_alternative_models() (50 LOC)                                ║
    ║ ✓ Remove redundant data serialization logic (45 LOC)                            ║
    ╚════════════════════════════════════════════════════════════════════════════════╝

    ╔════════════════════════════════════════════════════════════════════════════════╗
    ║ Priority 3: Standardize Method Naming (CONSISTENCY) - 2-5 LOC                  ║
    ║ ✓ Use _write_html() consistently across all renderers                          ║
    ║ ✓ Keep _write_report() as alias for backwards compatibility                    ║
    ║ ✓ Update all documentation and method references                               ║
    ╚════════════════════════════════════════════════════════════════════════════════╝

════════════════════════════════════════════════════════════════════════════════════════════════════════

                                    Refactoring Impact

    BEFORE (Current):           AFTER (Phase 3):
    ├── BaseRenderer: 678 LOC    ├── BaseRenderer: 434 LOC (244 removed)
    ├── Simple×4:    458 LOC     ├── Simple×4:    458 LOC (no change)
    └── Hyperparameter: 111 LOC  └── Hyperparameter: 61 LOC (50 saved)
                ────────                        ────────
    TOTAL:     1280 LOC         TOTAL:          953 LOC  (-25.4% reduction!)

════════════════════════════════════════════════════════════════════════════════════════════════════════
